<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->
<link hreF="../style.css" rel="stylesheet"></link>
<script src="../godocs.js"></script>

	
		<div id="short-nav">
			<dl>
			<dd><code>import "./server/model"</code></dd>
			</dl>
			<dl>
			<dd><a href="#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="#pkg-index">Index</a></dd>
			
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
datastore や blobstore などのサーバ上のデータを操作をまとめたもの。
シーン、イベント、アイテムなどゲームに関わるデータや、
仮登録ユーザ、本登録ユーザ、セッション管理などのユーザに関するデータを扱う。
</p>

			</div>
		</div>
		
	
		<h2 id="pkg-index">Index</h2>
		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
		<div id="manual-nav">
			<dl>
			
			
			
			
				
				<dd><a href="#Event">type Event</a></dd>
				
				
			
				
				<dd><a href="#Game">type Game</a></dd>
				
				
			
				
				<dd><a href="#InterimUser">type InterimUser</a></dd>
				
				
			
				
				<dd><a href="#Item">type Item</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#NewItem">func NewItem(name string, img string, hasFirst bool) *Item</a></dd>
				
				
			
				
				<dd><a href="#Model">type Model</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#NewModel">func NewModel(c appengine.Context) *Model</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.AddBlob">func (this *Model) AddBlob(file multipart.File, fileHeader *multipart.FileHeader) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.AddEvent">func (this *Model) AddEvent(event *Event, encodedSceneKey string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.AddGame">func (this *Model) AddGame(game *Game, encodedUserKey string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.AddItem">func (this *Model) AddItem(item *Item, encodedGameKey string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.AddScene">func (this *Model) AddScene(scene *Scene, id string, encodedGameKey string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.AddUser">func (this *Model) AddUser(user *User) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.CheckDuplicateBackground">func (this *Model) CheckDuplicateBackground(background string) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.ClearBlob">func (this *Model) ClearBlob()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.DeleteBlob">func (this *Model) DeleteBlob(key string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.DeleteEvent">func (this *Model) DeleteEvent(encodedEventKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.DeleteGame">func (this *Model) DeleteGame(encodedGameKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.DeleteInterimUser">func (this *Model) DeleteInterimUser(encodedInterimKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.DeleteItem">func (this *Model) DeleteItem(encodedItemKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.DeleteScene">func (this *Model) DeleteScene(encodedSceneKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.DeleteUser">func (this *Model) DeleteUser(encodedUserKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.ExistInterimUser">func (this *Model) ExistInterimUser(encodedInterimKey string) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.ExistOAuthUser">func (this *Model) ExistOAuthUser(userType string, oauthId string) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.ExistUser">func (this *Model) ExistUser(encodedUserKey string) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetAllUser">func (this *Model) GetAllUser() map[string]*User</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetBlob">func (this *Model) GetBlob(key string) (string, []byte)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetEvent">func (this *Model) GetEvent(encodedEventKey string) *Event</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetEventList">func (this *Model) GetEventList(encodedSceneKey string) map[string]*Event</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetEvents">func (this *Model) GetEvents(encodedSceneKey string) map[string]*Event</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetGame">func (this *Model) GetGame(encodedGameKey string) *Game</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetGameFromScene">func (this *Model) GetGameFromScene(encodedSceneKey string) (string, *Game)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetGameJSON">func (this *Model) GetGameJSON(encodedGameKey string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetGameList">func (this *Model) GetGameList(encodedUserKey string) map[string]*Game</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetInterimUsers">func (this *Model) GetInterimUsers() map[string]*InterimUser</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetItems">func (this *Model) GetItems(encodedGameKey string) map[string]*Item</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetScene">func (this *Model) GetScene(encodedSceneKey string) *Scene</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetSceneFromEvent">func (this *Model) GetSceneFromEvent(encodedEventKey string) (string, *Scene)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetScenes">func (this *Model) GetScenes(encodedGameKey string) map[string]*Scene</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetUser">func (this *Model) GetUser(encodedKey string) *User</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetUserFromMail">func (this *Model) GetUserFromMail(mail string) *User</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetUserKey">func (this *Model) GetUserKey(params map[string]string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.GetUserKeyFromSession">func (this *Model) GetUserKeyFromSession(sessionId string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.InterimRegistration">func (this *Model) InterimRegistration(name string, mail string, pass string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.LoginCheck">func (this *Model) LoginCheck(mail string, pass string) (string, string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.NewEvent">func (this *Model) NewEvent(name string, image string, code string, position []int, size []int, color string) *Event</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.NewGame">func (this *Model) NewGame(params map[string]string) *Game</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.NewInterimUser">func (this *Model) NewInterimUser(name string, mail string, pass string) *InterimUser</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.NewScene">func (this *Model) NewScene(name string, background string) *Scene</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.NewUser">func (this *Model) NewUser(data map[string]string) *User</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.Registration">func (this *Model) Registration(encodedKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.RemoveSession">func (this *Model) RemoveSession(sessionId string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.StartSession">func (this *Model) StartSession(userKey string) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.SyncEvent">func (this *Model) SyncEvent(w http.ResponseWriter, r *http.Request, path []string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.SyncGame">func (this *Model) SyncGame(w http.ResponseWriter, r *http.Request, path []string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.SyncItem">func (this *Model) SyncItem(w http.ResponseWriter, r *http.Request, path []string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.SyncScene">func (this *Model) SyncScene(w http.ResponseWriter, r *http.Request, path []string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.UpdateEvent">func (this *Model) UpdateEvent(event *Event, encodedEventKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.UpdateEventCode">func (this *Model) UpdateEventCode(id string, code string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.UpdateGame">func (this *Model) UpdateGame(encodedGameKey string, game *Game)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Model.UpdateScene">func (this *Model) UpdateScene(encodedSceneKey string, scene *Scene)</a></dd>
				
			
				
				<dd><a href="#Scene">type Scene</a></dd>
				
				
			
				
				<dd><a href="#User">type User</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#User.HashPassword">func (this *User) HashPassword(pass string, salt string) ([]byte, string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#User.ResetPassword">func (this *User) ResetPassword() string</a></dd>
				
			
			
		</dl>

		

		
			<h4>Package files</h4>
			<p>
			<span style="font-size:90%">
			
				<a href="/target/blob.go">blob.go</a>
			
				<a href="/target/event.go">event.go</a>
			
				<a href="/target/game.go">game.go</a>
			
				<a href="/target/item.go">item.go</a>
			
				<a href="/target/model.go">model.go</a>
			
				<a href="/target/scene.go">scene.go</a>
			
				<a href="/target/session.go">session.go</a>
			
				<a href="/target/user.go">user.go</a>
			
			</span>
			</p>
		
	
		
		
		
		
			
			
			<h2 id="Event">type <a href="/target/event.go?s=160:633#L2">Event</a></h2>
			<pre>type Event struct {
    Name     string `json:&#34;name&#34;`                  <span class="comment">// イベント名</span>
    Image    string `json:&#34;image&#34;`                 <span class="comment">// 画像</span>
    Code     []byte `json:&#34;-&#34;`                     <span class="comment">// クリックされた時のコード</span>
    RawCode  string `json:&#34;rawcode&#34; datastore:&#34;-&#34;` <span class="comment">// Codeをクライアントが読めるように文字列にしたもの</span>
    Position []int  `json:&#34;position&#34;`              <span class="comment">// 位置</span>
    Size     []int  `json:&#34;size&#34;`                  <span class="comment">// 大きさ</span>
    Color    string `json:&#34;color&#34;`                 <span class="comment">// エディタ上で領域に表示される色</span>
}</pre>
			<p>
シーンに含まれるイベントオブジェクト
</p>


			

			

			

			

			
		
			
			
			<h2 id="Game">type <a href="/target/game.go?s=452:908#L5">Game</a></h2>
			<pre>type Game struct {
    Name        string            `json:&#34;name&#34;`                    <span class="comment">// ゲーム名</span>
    Description string            `json:&#34;description&#34;`             <span class="comment">// ゲームの説明</span>
    Thumbnail   string            `json:&#34;thumbnail&#34;`               <span class="comment">// サムネイルの画像パス</span>
    FirstScene  string            `json:&#34;firstScene&#34;`              <span class="comment">// 最初のシーンのエンコード済みキー</span>
    SceneList   map[string]*Scene `json:&#34;sceneList&#34; datastore:&#34;-&#34;` <span class="comment">// シーン一覧</span>
    ItemList    map[string]*Item  `json:&#34;itemList&#34; datastore:&#34;-&#34;`  <span class="comment">// アイテム一覧</span>
}</pre>
			<p>
ゲームオブジェクト。ゲームはそれを所有するユーザにぶら下がる形で定義される。
ゲームは自分を所有するユーザを親として参照する形で datastore に保存される。
datastore の ancestor path を参照。
<a href="https://developers.google.com/appengine/docs/go/datastore/#Ancestor_Paths">https://developers.google.com/appengine/docs/go/datastore/#Ancestor_Paths</a>
</p>


			

			

			

			

			
		
			
			
			<h2 id="InterimUser">type <a href="/target/user.go?s=2359:2488#L55">InterimUser</a></h2>
			<pre>type InterimUser struct {
    Name string <span class="comment">// ユーザ名</span>
    Mail string <span class="comment">// メールアドレス</span>
    Pass string <span class="comment">// パスワード</span>
}</pre>
			<p>
仮登録ユーザ。トップページのユーザ登録フォームに入力されたユーザデータは一時的に仮登録データベースへ保存される。
ユーザが登録したメールアドレスに借り登録完了のメールが送られ、そのなかのURLをクリックすることで、
仮登録データベースからユーザデータベースへデータが移行される。
仮登録完了から 24 時間以内にメールの URL がクリックされなかった場合は、
仮登録データベースからユーザ情報が削除され、仮登録は失敗と鳴る。
</p>


			

			

			

			

			
		
			
			
			<h2 id="Item">type <a href="/target/item.go?s=122:251#L3">Item</a></h2>
			<pre>type Item struct {
    Name     string `json:&#34;name&#34;`
    Img      string `json:&#34;img&#34;`
    HasFirst bool   `json:&#34;hasFirst&#34;`
    Sort     int    `json:&#34;sort&#34;`
}</pre>
			<p>
アイテム型
</p>


			

			

			

			
				
				<h3 id="NewItem">func <a href="/target/item.go?s=278:336#L11">NewItem</a></h3>
				<pre>func NewItem(name string, img string, hasFirst bool) *Item</pre>
				<p>
アイテムの作成
</p>

				
			

			
		
			
			
			<h2 id="Model">type <a href="/target/model.go?s=410:452#L1">Model</a></h2>
			<pre>type Model struct {
    <span class="comment">// contains filtered or unexported fields</span>
}</pre>
			<p>
アプリケーションのデータ操作を行うオブジェクト
</p>


			

			

			

			
				
				<h3 id="NewModel">func <a href="/target/model.go?s=567:608#L7">NewModel</a></h3>
				<pre>func NewModel(c appengine.Context) *Model</pre>
				<p>
モデルのインスタンスを作成する。
モデルを使う前にかならず実行すること。
</p>

				
			

			
				
				<h3 id="Model.AddBlob">func (*Model) <a href="/target/blob.go?s=377:465#L4">AddBlob</a></h3>
				<pre>func (this *Model) AddBlob(file multipart.File, fileHeader *multipart.FileHeader) string</pre>
				<p>
ファイルを blobstore に保存して blobkey を返す。
エディタから画像ファイルをアップロードするときに使う。
引数としてファイルと、ファイルの種類などを含むファイルヘッダを渡す。
</p>

				
				
			
				
				<h3 id="Model.AddEvent">func (*Model) <a href="/target/event.go?s=1131:1203#L27">AddEvent</a></h3>
				<pre>func (this *Model) AddEvent(event *Event, encodedSceneKey string) string</pre>
				<p>
イベントの追加。エンコード済みのキーを返す。
引数としてイベントが蔵するシーンキーを渡す。
</p>

				
				
			
				
				<h3 id="Model.AddGame">func (*Model) <a href="/target/game.go?s=1592:1660#L27">AddGame</a></h3>
				<pre>func (this *Model) AddGame(game *Game, encodedUserKey string) string</pre>
				<p>
データストアにゲームを追加してエンコード済みのキーを返す。
引数として追加するゲームオブジェクトと、エンコード済みユーザキーを渡す。
引数として渡したユーザキーにぶら下がる形でゲームが保存される。
</p>

				
				
			
				
				<h3 id="Model.AddItem">func (*Model) <a href="/target/item.go?s=623:691#L23">AddItem</a></h3>
				<pre>func (this *Model) AddItem(item *Item, encodedGameKey string) string</pre>
				<p>
アイテムの追加。
追加したいアイテムと、追加するゲームキーを渡す。
追加したアイテムのエンコード済みキーを返す。
</p>

				
				
			
				
				<h3 id="Model.AddScene">func (*Model) <a href="/target/scene.go?s=1692:1774#L27">AddScene</a></h3>
				<pre>func (this *Model) AddScene(scene *Scene, id string, encodedGameKey string) string</pre>
				<p>
シーンをデータストアへ追加する。
シーンが追加されるのはエディタでシーンを新規作成した時だけ。
Backbone.js がモデルに対して自動的に割り振る cid をデータストアの StringID として使う。
引数として追加するシーン、cid、追加先のゲームキーを渡す。
追加に成功したらエンコード済みのシーンキーを返す
</p>

				
				
			
				
				<h3 id="Model.AddUser">func (*Model) <a href="/target/user.go?s=4039:4084#L100">AddUser</a></h3>
				<pre>func (this *Model) AddUser(user *User) string</pre>
				<p>
データストアに引数として渡したユーザを新規追加する。
追加が完了したらユーザキーを返す。
</p>

				
				
			
				
				<h3 id="Model.CheckDuplicateBackground">func (*Model) <a href="/target/scene.go?s=5978:6045#L160">CheckDuplicateBackground</a></h3>
				<pre>func (this *Model) CheckDuplicateBackground(background string) bool</pre>
				<p>
指定された背景画像が２つ以上のシーンから参照されているかどうかを調べる。
複数から参照されていれば ture, それ以外は false を返す。
background は blobkey。
</p>

				
				
			
				
				<h3 id="Model.ClearBlob">func (*Model) <a href="/target/blob.go?s=2788:2818#L77">ClearBlob</a></h3>
				<pre>func (this *Model) ClearBlob()</pre>
				<p>
すべてのblobを削除する。管理者専用。
</p>

				
				
			
				
				<h3 id="Model.DeleteBlob">func (*Model) <a href="/target/blob.go?s=2494:2535#L67">DeleteBlob</a></h3>
				<pre>func (this *Model) DeleteBlob(key string)</pre>
				<p>
blogstore に保存されているフィアルを削除する。
引数として削除する blobkey を渡す。
</p>

				
				
			
				
				<h3 id="Model.DeleteEvent">func (*Model) <a href="/target/event.go?s=2045:2099#L60">DeleteEvent</a></h3>
				<pre>func (this *Model) DeleteEvent(encodedEventKey string)</pre>
				<p>
イベントの削除
</p>

				
				
			
				
				<h3 id="Model.DeleteGame">func (*Model) <a href="/target/game.go?s=3377:3429#L80">DeleteGame</a></h3>
				<pre>func (this *Model) DeleteGame(encodedGameKey string)</pre>
				<p>
データストアから指定したキーのゲームを削除する。
削除を命令したユーザとゲームの所有者が一致していることを事前に確認すること。
この関数内ではチェックを行わない。
</p>

				
				
			
				
				<h3 id="Model.DeleteInterimUser">func (*Model) <a href="/target/user.go?s=10591:10653#L307">DeleteInterimUser</a></h3>
				<pre>func (this *Model) DeleteInterimUser(encodedInterimKey string)</pre>
				<p>
仮登録ユーザを削除する
</p>

				
				
			
				
				<h3 id="Model.DeleteItem">func (*Model) <a href="/target/item.go?s=995:1047#L36">DeleteItem</a></h3>
				<pre>func (this *Model) DeleteItem(encodedItemKey string)</pre>
				<p>
アイテムの削除
</p>

				
				
			
				
				<h3 id="Model.DeleteScene">func (*Model) <a href="/target/scene.go?s=2877:2931#L61">DeleteScene</a></h3>
				<pre>func (this *Model) DeleteScene(encodedSceneKey string)</pre>
				<p>
引数として指定された id のシーンをデータストアから削除する。
</p>

				
				
			
				
				<h3 id="Model.DeleteUser">func (*Model) <a href="/target/user.go?s=4409:4461#L113">DeleteUser</a></h3>
				<pre>func (this *Model) DeleteUser(encodedUserKey string)</pre>
				<p>
ユーザの削除
</p>

				
				
			
				
				<h3 id="Model.ExistInterimUser">func (*Model) <a href="/target/user.go?s=10293:10359#L295">ExistInterimUser</a></h3>
				<pre>func (this *Model) ExistInterimUser(encodedInterimKey string) bool</pre>
				<p>
指定された仮登録ユーザがいるか調べる
</p>

				
				
			
				
				<h3 id="Model.ExistOAuthUser">func (*Model) <a href="/target/user.go?s=8704:8775#L237">ExistOAuthUser</a></h3>
				<pre>func (this *Model) ExistOAuthUser(userType string, oauthId string) bool</pre>
				<p>
指定されたOAuthユーザが既にデータベース上に存在するかどうか調べる。
存在したら true、存在しなかったら false を返す。
userType に &#34;Twitter&#34; または &#34;Facebook&#34; を指定すること。
oauthId に調べる対象の OAuthId を指定する。
</p>

				
				
			
				
				<h3 id="Model.ExistUser">func (*Model) <a href="/target/user.go?s=10000:10056#L283">ExistUser</a></h3>
				<pre>func (this *Model) ExistUser(encodedUserKey string) bool</pre>
				<p>
指定されたユーザがいるか調べる
</p>

				
				
			
				
				<h3 id="Model.GetAllUser">func (*Model) <a href="/target/user.go?s=10816:10864#L314">GetAllUser</a></h3>
				<pre>func (this *Model) GetAllUser() map[string]*User</pre>
				<p>
すべてのユーザを取得する
</p>

				
				
			
				
				<h3 id="Model.GetBlob">func (*Model) <a href="/target/blob.go?s=1347:1402#L36">GetBlob</a></h3>
				<pre>func (this *Model) GetBlob(key string) (string, []byte)</pre>
				<p>
blobstore に保存したファイルを読み出す。
引数として読みだすファイルの blobkey を渡す。
ファイルタイプとバイナリデータが返される。
</p>

				
				
			
				
				<h3 id="Model.GetEvent">func (*Model) <a href="/target/event.go?s=1518:1576#L40">GetEvent</a></h3>
				<pre>func (this *Model) GetEvent(encodedEventKey string) *Event</pre>
				<p>
イベントを取得
</p>

				
				
			
				
				<h3 id="Model.GetEventList">func (*Model) <a href="/target/event.go?s=2311:2384#L69">GetEventList</a></h3>
				<pre>func (this *Model) GetEventList(encodedSceneKey string) map[string]*Event</pre>
				<p>
指定されたシーンに属するイベント一覧を返す
</p>

				
				
			
				
				<h3 id="Model.GetEvents">func (*Model) <a href="/target/scene.go?s=3736:3806#L87">GetEvents</a></h3>
				<pre>func (this *Model) GetEvents(encodedSceneKey string) map[string]*Event</pre>
				<p>
シーン内のイベントリストを取得する
</p>

				
				
			
				
				<h3 id="Model.GetGame">func (*Model) <a href="/target/game.go?s=2024:2079#L38">GetGame</a></h3>
				<pre>func (this *Model) GetGame(encodedGameKey string) *Game</pre>
				<p>
エンコード済みのキーを指定してデータストアからゲームを取得する。
</p>

				
				
			
				
				<h3 id="Model.GetGameFromScene">func (*Model) <a href="/target/game.go?s=4649:4724#L126">GetGameFromScene</a></h3>
				<pre>func (this *Model) GetGameFromScene(encodedSceneKey string) (string, *Game)</pre>
				<p>
指定されたシーンが含まれているゲームを取得する
</p>

				
				
			
				
				<h3 id="Model.GetGameJSON">func (*Model) <a href="/target/game.go?s=2398:2458#L53">GetGameJSON</a></h3>
				<pre>func (this *Model) GetGameJSON(encodedGameKey string) string</pre>
				<p>
JSON 形式でゲームを取得する
</p>

				
				
			
				
				<h3 id="Model.GetGameList">func (*Model) <a href="/target/user.go?s=11367:11437#L334">GetGameList</a></h3>
				<pre>func (this *Model) GetGameList(encodedUserKey string) map[string]*Game</pre>
				<p>
ユーザが所有しているゲーム一覧を返す。
戻り値は、エンコード済みのゲームキーとゲームの対応表
</p>

				
				
			
				
				<h3 id="Model.GetInterimUsers">func (*Model) <a href="/target/user.go?s=9510:9570#L264">GetInterimUsers</a></h3>
				<pre>func (this *Model) GetInterimUsers() map[string]*InterimUser</pre>
				<p>
仮登録ユーザ一覧を返す
</p>

				
				
			
				
				<h3 id="Model.GetItems">func (*Model) <a href="/target/item.go?s=1337:1404#L51">GetItems</a></h3>
				<pre>func (this *Model) GetItems(encodedGameKey string) map[string]*Item</pre>
				<p>
アイテム一覧の取得。
</p>

				
				
			
				
				<h3 id="Model.GetScene">func (*Model) <a href="/target/scene.go?s=2079:2137#L37">GetScene</a></h3>
				<pre>func (this *Model) GetScene(encodedSceneKey string) *Scene</pre>
				<p>
シーンをデータストアから取得する
</p>

				
				
			
				
				<h3 id="Model.GetSceneFromEvent">func (*Model) <a href="/target/scene.go?s=2502:2579#L52">GetSceneFromEvent</a></h3>
				<pre>func (this *Model) GetSceneFromEvent(encodedEventKey string) (string, *Scene)</pre>
				<p>
指定されたイベントが属しているシーンを取得する
</p>

				
				
			
				
				<h3 id="Model.GetScenes">func (*Model) <a href="/target/game.go?s=4051:4120#L102">GetScenes</a></h3>
				<pre>func (this *Model) GetScenes(encodedGameKey string) map[string]*Scene</pre>
				<p>
ゲーム内のシーン一覧を取得する。引数としてゲームキーを渡す。
戻り値としてシーンID(エンコード済みキー)を key、シーンオブジェクトを value とした map を返す。
</p>

				
				
			
				
				<h3 id="Model.GetUser">func (*Model) <a href="/target/user.go?s=6160:6211#L166">GetUser</a></h3>
				<pre>func (this *Model) GetUser(encodedKey string) *User</pre>
				<p>
引数として渡されたユーザキーのユーザをデータストアから取得する。
成功したら取得したユーザオブジェクトを返す。
</p>

				
				
			
				
				<h3 id="Model.GetUserFromMail">func (*Model) <a href="/target/user.go?s=6634:6687#L181">GetUserFromMail</a></h3>
				<pre>func (this *Model) GetUserFromMail(mail string) *User</pre>
				<p>
メールアドレスからユーザを取得する
存在したらユーザを返す
複数存在したり、存在しなかったらからユーザを返す
このシステムでは同じメールアドレスは２つ登録できない仕様
</p>

				
				
			
				
				<h3 id="Model.GetUserKey">func (*Model) <a href="/target/user.go?s=9167:9229#L250">GetUserKey</a></h3>
				<pre>func (this *Model) GetUserKey(params map[string]string) string</pre>
				<p>
パラメータで指定されたユーザを探してユーザキーを返す。
存在しない場合は空文字を返す。
params には検索条件をセットする。
</p>

				
				
			
				
				<h3 id="Model.GetUserKeyFromSession">func (*Model) <a href="/target/session.go?s=1300:1365#L34">GetUserKeyFromSession</a></h3>
				<pre>func (this *Model) GetUserKeyFromSession(sessionId string) string</pre>
				<p>
memcache から指定されたセッションIDに関連づいているユーザキーを返す
該当するユーザーキーが見つからなかったら空文字を返す
</p>

				
				
			
				
				<h3 id="Model.InterimRegistration">func (*Model) <a href="/target/user.go?s=7436:7520#L203">InterimRegistration</a></h3>
				<pre>func (this *Model) InterimRegistration(name string, mail string, pass string) string</pre>
				<p>
ユーザを仮登録データベースに登録する。
仮登録されたユーザは24時間以内に本登録する。
本登録されなかった場合は24時間後に削除される。
仮登録ユーザのエンコードされたキーを返す。
</p>

				
				
			
				
				<h3 id="Model.LoginCheck">func (*Model) <a href="/target/user.go?s=5311:5383#L142">LoginCheck</a></h3>
				<pre>func (this *Model) LoginCheck(mail string, pass string) (string, string)</pre>
				<p>
引数として渡したメールアドレスとパスワードのユーザがいるか調べる。
存在した場合はユーザキーとユーザ名を返す。
存在しない場合は戻り値がすべて空文字になる。
</p>

				
				
			
				
				<h3 id="Model.NewEvent">func (*Model) <a href="/target/event.go?s=678:794#L13">NewEvent</a></h3>
				<pre>func (this *Model) NewEvent(name string, image string, code string, position []int, size []int, color string) *Event</pre>
				<p>
イベントオブジェクトの作成
</p>

				
				
			
				
				<h3 id="Model.NewGame">func (*Model) <a href="/target/game.go?s=1066:1124#L15">NewGame</a></h3>
				<pre>func (this *Model) NewGame(params map[string]string) *Game</pre>
				<p>
新しいゲームオブジェクトを作成して返す。新しく作られるゲームのパラメータを格納した map 引数として渡す。
</p>

				
				
			
				
				<h3 id="Model.NewInterimUser">func (*Model) <a href="/target/user.go?s=2684:2769#L63">NewInterimUser</a></h3>
				<pre>func (this *Model) NewInterimUser(name string, mail string, pass string) *InterimUser</pre>
				<p>
仮登録ユーザを作成する。引数としてユーザ名、メールアドレス、パスワードを渡す。
新規作成された仮登録ユーザオブジェクトを返す。
</p>

				
				
			
				
				<h3 id="Model.NewScene">func (*Model) <a href="/target/scene.go?s=1104:1170#L15">NewScene</a></h3>
				<pre>func (this *Model) NewScene(name string, background string) *Scene</pre>
				<p>
シーンオブジェクトを新しく作成する。
</p>

				
				
			
				
				<h3 id="Model.NewUser">func (*Model) <a href="/target/user.go?s=680:736#L14">NewUser</a></h3>
				<pre>func (this *Model) NewUser(data map[string]string) *User</pre>
				<p>
ユーザオブジェクトを作成する。
戻り値は作成したユーザ、失敗したらnil。
</p>

				
				
			
				
				<h3 id="Model.Registration">func (*Model) <a href="/target/user.go?s=7844:7894#L212">Registration</a></h3>
				<pre>func (this *Model) Registration(encodedKey string)</pre>
				<p>
仮登録ユーザキーを指定して、該当するユーザを登録する。
</p>

				
				
			
				
				<h3 id="Model.RemoveSession">func (*Model) <a href="/target/session.go?s=1000:1050#L27">RemoveSession</a></h3>
				<pre>func (this *Model) RemoveSession(sessionId string)</pre>
				<p>
memcache から指定されたセッションIDのセッション情報を削除する
</p>

				
				
			
				
				<h3 id="Model.StartSession">func (*Model) <a href="/target/session.go?s=421:475#L4">StartSession</a></h3>
				<pre>func (this *Model) StartSession(userKey string) string</pre>
				<p>
セッションを開始する。サーバの memcache 内にセッションIDとユーザキーの対応を保存している。
セッションは最後のページアクセスから24時間の有効で、24時間経過したものは cron で定期的に削除される。
関数はセッションIDを返す。
</p>

				
				
			
				
				<h3 id="Model.SyncEvent">func (*Model) <a href="/target/event.go?s=3051:3134#L96">SyncEvent</a></h3>
				<pre>func (this *Model) SyncEvent(w http.ResponseWriter, r *http.Request, path []string)</pre>
				<p>
イベントの同期
</p>

				
				
			
				
				<h3 id="Model.SyncGame">func (*Model) <a href="/target/game.go?s=5081:5163#L139">SyncGame</a></h3>
				<pre>func (this *Model) SyncGame(w http.ResponseWriter, r *http.Request, path []string)</pre>
				<p>
ゲームデータの同期。
リクエストのメソッドが CRUD に対応している。
POST:CREATE, GET:READ, PUT:UPDATE, DELETE:DELETE
</p>

				
				
			
				
				<h3 id="Model.SyncItem">func (*Model) <a href="/target/item.go?s=1880:1962#L76">SyncItem</a></h3>
				<pre>func (this *Model) SyncItem(w http.ResponseWriter, r *http.Request, path []string)</pre>
				<p>
アイテムの同期
</p>

				
				
			
				
				<h3 id="Model.SyncScene">func (*Model) <a href="/target/scene.go?s=4687:4770#L116">SyncScene</a></h3>
				<pre>func (this *Model) SyncScene(w http.ResponseWriter, r *http.Request, path []string)</pre>
				<p>
シーンデータの同期処理を行う。
/sync/scene/[gamekey] というURLでリクエストが送られる。
リクエストのメソッドが CRUD に対応している。
POST:CREATE, GET:READ, PUT:UPDATE, DELETE:DELETE.
リクエストのメソッドに合わせて適切な関数を使用する。
</p>

				
				
			
				
				<h3 id="Model.UpdateEvent">func (*Model) <a href="/target/event.go?s=1800:1868#L51">UpdateEvent</a></h3>
				<pre>func (this *Model) UpdateEvent(event *Event, encodedEventKey string)</pre>
				<p>
イベントを更新する
</p>

				
				
			
				
				<h3 id="Model.UpdateEventCode">func (*Model) <a href="/target/event.go?s=2878:2936#L89">UpdateEventCode</a></h3>
				<pre>func (this *Model) UpdateEventCode(id string, code string)</pre>
				<p>
イベントコードの更新
</p>

				
				
			
				
				<h3 id="Model.UpdateGame">func (*Model) <a href="/target/game.go?s=2915:2979#L69">UpdateGame</a></h3>
				<pre>func (this *Model) UpdateGame(encodedGameKey string, game *Game)</pre>
				<p>
ゲームを更新する。引数として渡されたキー encodedGameKey のゲームを、ゲームオブジェクト game で上書きする。
</p>

				
				
			
				
				<h3 id="Model.UpdateScene">func (*Model) <a href="/target/scene.go?s=3482:3550#L80">UpdateScene</a></h3>
				<pre>func (this *Model) UpdateScene(encodedSceneKey string, scene *Scene)</pre>
				<p>
id で指定されたシーンを新しいシーン scene で更新する。
</p>

				
				
			
		
			
			
			<h2 id="Scene">type <a href="/target/scene.go?s=260:1044#L3">Scene</a></h2>
			<pre>type Scene struct {
    Name       string            `json:&#34;name&#34;`                    <span class="comment">// シーン名</span>
    Background string            `json:&#34;background&#34;`              <span class="comment">// 背景画像のBlobkey、設定していなければ空文字</span>
    Enter      []byte            `json:&#34;-&#34;`                       <span class="comment">// シーン開始時のイベント（データベース保存用バイナリ）</span>
    RawEnter   string            `json:&#34;enter&#34; datastore:&#34;-&#34;`     <span class="comment">// シーン開始時のイベント（クライアント用文字列）</span>
    Leave      []byte            `json:&#34;-&#34;`                       <span class="comment">// シーン終了時のイベント（データベース保存用バイナリ）</span>
    RawLeave   string            `json:&#34;leave&#34; datastore:&#34;-&#34;`     <span class="comment">// シーン終了時のイベント（クライアント用文字列）</span>
    Sort       int               `json:&#34;sort&#34;`                    <span class="comment">// 並び順</span>
    EventList  map[string]*Event `json:&#34;eventList&#34; datastore:&#34;-&#34;` <span class="comment">// シーン内のイベントリスト</span>
}</pre>
			<p>
シーンオブジェクト。ゲームを構成する場面を表す。
背景画像、開始時のイベント、終了時のイベントを持つ。
</p>


			

			

			

			

			
		
			
			
			<h2 id="User">type <a href="/target/user.go?s=116:568#L3">User</a></h2>
			<pre>type User struct {
    Type    string <span class="comment">// ユーザアカウントの種類 &#34;Twitter&#34;/&#34;Facebook&#34;/&#34;normal&#34;/&#34;guest&#34;</span>
    Name    string <span class="comment">// ユーザ名</span>
    Pass    []byte <span class="comment">// ユーザの暗号化済パスワード（user_type == &#34;normal&#34;の場合のみ）</span>
    Mail    string <span class="comment">// ユーザのメールアドレス（user_type == &#34;normal&#34;の場合のみ）</span>
    Salt    string <span class="comment">// パスワードソルト</span>
    OAuthId string <span class="comment">// OAuthのサービスプロバイダが決めたユーザID</span>
}</pre>
			<p>
ユーザデータ
</p>


			

			

			

			

			
				
				<h3 id="User.HashPassword">func (*User) <a href="/target/user.go?s=3242:3315#L75">HashPassword</a></h3>
				<pre>func (this *User) HashPassword(pass string, salt string) ([]byte, string)</pre>
				<p>
ユーザのパスワードをハッシュ化する。引数として平文のパスワードと、ソルトを渡す。
引数として渡すソルトが空文字の場合は自動でランダムな文字列を作成する。
ハッシュ化が成功したら、ハッシュ化されたパスワードとソルトを返す。
ハッシュは SHA-1 を使う。
</p>

				
				
			
				
				<h3 id="User.ResetPassword">func (*User) <a href="/target/user.go?s=3668:3708#L88">ResetPassword</a></h3>
				<pre>func (this *User) ResetPassword() string</pre>
				<p>
ユーザのパスワードをリセットする(16文字のランダム文字列)
リセット後のパスワードを返す
</p>

				
				
			
		
		</div>
	

	







