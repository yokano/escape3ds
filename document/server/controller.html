<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->
<link hreF="../style.css" rel="stylesheet"></link>
<script src="../godocs.js"></script>

	
		<div id="short-nav">
			<dl>
			<dd><code>import "./server/controller"</code></dd>
			</dl>
			<dl>
			<dd><a href="#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="#pkg-index">Index</a></dd>
			
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
リクエスト URL のパターンに該当する処理をする。
必要に応じて Model と View を使って処理を進める。
</p>

			</div>
		</div>
		
	
		<h2 id="pkg-index">Index</h2>
		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
		<div id="manual-nav">
			<dl>
			
			
			
			
				
				<dd><a href="#Controller">type Controller</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#NewController">func NewController() *Controller</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.AddGame">func (this *Controller) AddGame(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.AddUser">func (this *Controller) AddUser(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.CallbackFacebook">func (this *Controller) CallbackFacebook(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.CallbackTwitter">func (this *Controller) CallbackTwitter(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.CloseSession">func (this *Controller) CloseSession(c appengine.Context, w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Debug">func (this *Controller) Debug(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.DeleteCookie">func (this *Controller) DeleteCookie(c appengine.Context, w http.ResponseWriter)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.DeleteGame">func (this *Controller) DeleteGame(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Download">func (this *Controller) Download(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Editor">func (this *Controller) Editor(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Gamelist">func (this *Controller) Gamelist(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.GetHandler">func (this *Controller) GetHandler(callback func(this *Controller, w http.ResponseWriter, r *http.Request)) func(http.ResponseWriter, *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.GetInterimUsers">func (this *Controller) GetInterimUsers(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.GetSession">func (this *Controller) GetSession(c appengine.Context, r *http.Request) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.GetUsers">func (this *Controller) GetUsers(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Handle">func (this *Controller) Handle()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.InterimRegistration">func (this *Controller) InterimRegistration(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Login">func (this *Controller) Login(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.LoginFacebook">func (this *Controller) LoginFacebook(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.LoginTwitter">func (this *Controller) LoginTwitter(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Logout">func (this *Controller) Logout(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Registration">func (this *Controller) Registration(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.RequestFacebookToken">func (this *Controller) RequestFacebookToken(w http.ResponseWriter, r *http.Request) map[string]string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Session">func (this *Controller) Session(w http.ResponseWriter, r *http.Request) string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.StartSession">func (this *Controller) StartSession(w http.ResponseWriter, r *http.Request, key string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.SyncGame">func (this *Controller) SyncGame(c appengine.Context, w http.ResponseWriter, r *http.Request, gameKey string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.SyncHandler">func (this *Controller) SyncHandler(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.SyncScene">func (this *Controller) SyncScene(c appengine.Context, w http.ResponseWriter, r *http.Request, sceneId string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Top">func (this *Controller) Top(w http.ResponseWriter, r *http.Request)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#Controller.Upload">func (this *Controller) Upload(w http.ResponseWriter, r *http.Request)</a></dd>
				
			
			
		</dl>

		

		
			<h4>Package files</h4>
			<p>
			<span style="font-size:90%">
			
				<a href="/target/admin.go">admin.go</a>
			
				<a href="/target/api.go">api.go</a>
			
				<a href="/target/controller.go">controller.go</a>
			
				<a href="/target/login.go">login.go</a>
			
				<a href="/target/page.go">page.go</a>
			
				<a href="/target/session.go">session.go</a>
			
			</span>
			</p>
		
	
		
		
		
		
			
			
			<h2 id="Controller">type <a href="/target/controller.go?s=227:253#L1">Controller</a></h2>
			<pre>type Controller struct {
}</pre>
			<p>
コントローラオブジェクト
</p>


			

			

			

			
				
				<h3 id="NewController">func <a href="/target/controller.go?s=309:341#L4">NewController</a></h3>
				<pre>func NewController() *Controller</pre>
				<p>
Controller オブジェクトを作成して返す
</p>

				
			

			
				
				<h3 id="Controller.AddGame">func (*Controller) <a href="/target/api.go?s=2991:3062#L90">AddGame</a></h3>
				<pre>func (this *Controller) AddGame(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ゲームの新規追加
</p>

				
				
			
				
				<h3 id="Controller.AddUser">func (*Controller) <a href="/target/api.go?s=214:285#L6">AddUser</a></h3>
				<pre>func (this *Controller) AddUser(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ユーザの追加。Ajax で呼び出す API。
</p>

				
				
			
				
				<h3 id="Controller.CallbackFacebook">func (*Controller) <a href="/target/login.go?s=3360:3439#L89">CallbackFacebook</a></h3>
				<pre>func (this *Controller) CallbackFacebook(w http.ResponseWriter, r *http.Request)</pre>
				<p>
Facebook でユーザがアクセスを許可した時に呼び出されるコールバック関数
</p>

				
				
			
				
				<h3 id="Controller.CallbackTwitter">func (*Controller) <a href="/target/login.go?s=670:749#L14">CallbackTwitter</a></h3>
				<pre>func (this *Controller) CallbackTwitter(w http.ResponseWriter, r *http.Request)</pre>
				<p>
Twitter でユーザが許可をした時に呼び出されるコールバック関数
</p>

				
				
			
				
				<h3 id="Controller.CloseSession">func (*Controller) <a href="/target/session.go?s=1244:1341#L29">CloseSession</a></h3>
				<pre>func (this *Controller) CloseSession(c appengine.Context, w http.ResponseWriter, r *http.Request)</pre>
				<p>
セッションを終了する。
</p>

				
				
			
				
				<h3 id="Controller.Debug">func (*Controller) <a href="/target/admin.go?s=166:235#L4">Debug</a></h3>
				<pre>func (this *Controller) Debug(w http.ResponseWriter, r *http.Request)</pre>
				<p>
デバッグツールの表示
</p>

				
				
			
				
				<h3 id="Controller.DeleteCookie">func (*Controller) <a href="/target/session.go?s=1533:1613#L38">DeleteCookie</a></h3>
				<pre>func (this *Controller) DeleteCookie(c appengine.Context, w http.ResponseWriter)</pre>
				<p>
セッション ID が保存されたクッキーを削除する
</p>

				
				
			
				
				<h3 id="Controller.DeleteGame">func (*Controller) <a href="/target/api.go?s=4163:4237#L124">DeleteGame</a></h3>
				<pre>func (this *Controller) DeleteGame(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ゲームの削除。
ゲームは所有者しか削除することはできない。
</p>

				
				
			
				
				<h3 id="Controller.Download">func (*Controller) <a href="/target/api.go?s=5601:5673#L168">Download</a></h3>
				<pre>func (this *Controller) Download(w http.ResponseWriter, r *http.Request)</pre>
				<p>
blobstore から blogkey に関連付いたファイルをクライアントへ渡す。
Ajax で使う。method は GET。
</p>

				
				
			
				
				<h3 id="Controller.Editor">func (*Controller) <a href="/target/page.go?s=480:550#L13">Editor</a></h3>
				<pre>func (this *Controller) Editor(w http.ResponseWriter, r *http.Request)</pre>
				<p>
エディタの表示
</p>

				
				
			
				
				<h3 id="Controller.Gamelist">func (*Controller) <a href="/target/page.go?s=1208:1280#L35">Gamelist</a></h3>
				<pre>func (this *Controller) Gamelist(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ゲーム一覧の表示。ログインした状態でトップページを表示するとここへ飛ぶ。
</p>

				
				
			
				
				<h3 id="Controller.GetHandler">func (*Controller) <a href="/target/controller.go?s=735:883#L12">GetHandler</a></h3>
				<pre>func (this *Controller) GetHandler(callback func(this *Controller, w http.ResponseWriter, r *http.Request)) func(http.ResponseWriter, *http.Request)</pre>
				<p>
メソッドを http.HandleFunc() で呼び出し可能な関数型に変換して返す。
http.HandleFunc() は引数として func(http.ResponseWriter, *http.Request) 型の関数しか渡せない。
コントローラのメソッドをこの関数型で包むことで http.HandleFunc() から呼び出し可能にする。
</p>

				
				
			
				
				<h3 id="Controller.GetInterimUsers">func (*Controller) <a href="/target/admin.go?s=368:447#L11">GetInterimUsers</a></h3>
				<pre>func (this *Controller) GetInterimUsers(w http.ResponseWriter, r *http.Request)</pre>
				<p>
仮登録ユーザ一覧の取得。Ajax で呼び出す
</p>

				
				
			
				
				<h3 id="Controller.GetSession">func (*Controller) <a href="/target/session.go?s=907:986#L14">GetSession</a></h3>
				<pre>func (this *Controller) GetSession(c appengine.Context, r *http.Request) string</pre>
				<p>
ブラウザの Cookie に保存されているセッションIDを取得する。
セッションが存在しない場合は空文字を返す。
</p>

				
				
			
				
				<h3 id="Controller.GetUsers">func (*Controller) <a href="/target/admin.go?s=836:908#L28">GetUsers</a></h3>
				<pre>func (this *Controller) GetUsers(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ユーザ一覧の取得。Ajax で呼び出す
</p>

				
				
			
				
				<h3 id="Controller.Handle">func (*Controller) <a href="/target/controller.go?s=1033:1065#L19">Handle</a></h3>
				<pre>func (this *Controller) Handle()</pre>
				<p>
リクエスト URL に合わせて処理を振り分ける
</p>

				
				
			
				
				<h3 id="Controller.InterimRegistration">func (*Controller) <a href="/target/api.go?s=2091:2174#L60">InterimRegistration</a></h3>
				<pre>func (this *Controller) InterimRegistration(w http.ResponseWriter, r *http.Request)</pre>
				<p>
Ajax のリクエストパラメータとして渡されたユーザを仮登録データベースに保存して、
本登録のためのメールを送信する。
</p>

				
				
			
				
				<h3 id="Controller.Login">func (*Controller) <a href="/target/api.go?s=941:1010#L24">Login</a></h3>
				<pre>func (this *Controller) Login(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ログイン。成功か失敗か判断してからページを遷移するために Ajax で呼び出す。
成功したらリダイレクト先の URL を含む JSON を返す。
失敗したらエラーメッセージを含む JSON を返す。
</p>

				
				
			
				
				<h3 id="Controller.LoginFacebook">func (*Controller) <a href="/target/login.go?s=1935:2012#L56">LoginFacebook</a></h3>
				<pre>func (this *Controller) LoginFacebook(w http.ResponseWriter, r *http.Request)</pre>
				<p>
Facebook のログインボタンが押された時の処理
</p>

				
				
			
				
				<h3 id="Controller.LoginTwitter">func (*Controller) <a href="/target/login.go?s=210:286#L6">LoginTwitter</a></h3>
				<pre>func (this *Controller) LoginTwitter(w http.ResponseWriter, r *http.Request)</pre>
				<p>
Twitter ボタンが押された時の処理
</p>

				
				
			
				
				<h3 id="Controller.Logout">func (*Controller) <a href="/target/api.go?s=1619:1689#L45">Logout</a></h3>
				<pre>func (this *Controller) Logout(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ログアウト。クッキーと memcache に保存されたセッション情報を削除する。
</p>

				
				
			
				
				<h3 id="Controller.Registration">func (*Controller) <a href="/target/api.go?s=2729:2805#L78">Registration</a></h3>
				<pre>func (this *Controller) Registration(w http.ResponseWriter, r *http.Request)</pre>
				<p>
仮登録済みのユーザを本登録する。
仮登録データベースからユーザを削除してユーザデータベースへ追加する。
</p>

				
				
			
				
				<h3 id="Controller.RequestFacebookToken">func (*Controller) <a href="/target/login.go?s=2478:2580#L65">RequestFacebookToken</a></h3>
				<pre>func (this *Controller) RequestFacebookToken(w http.ResponseWriter, r *http.Request) map[string]string</pre>
				<p>
Facebook へアクセストークンを要求する。
この関数は Facebook から認証コードをリダイレクトで渡された時に呼ばれる。
ユーザ情報を格納した map を返す。
</p>

				
				
			
				
				<h3 id="Controller.Session">func (*Controller) <a href="/target/session.go?s=2064:2142#L48">Session</a></h3>
				<pre>func (this *Controller) Session(w http.ResponseWriter, r *http.Request) string</pre>
				<p>
現在の通信にセッションが存在するかどうかを調べる。
ページ表示時に必ず実行する。
持っていなければトップページへ飛ばして空文字を返す。
持っていたら対応するユーザIDを返す。
これによってログインせずに内部ページを表示することを防止する。
</p>

				
				
			
				
				<h3 id="Controller.StartSession">func (*Controller) <a href="/target/session.go?s=479:567#L4">StartSession</a></h3>
				<pre>func (this *Controller) StartSession(w http.ResponseWriter, r *http.Request, key string)</pre>
				<p>
引数として渡されたユーザキーに該当するユーザのセッションを開始する。
ユーザーキーに関連付いたセッションIDを生成して memcache と cookie に保存する。
ブラウザが提供する cookie に保存されたセッションIDを memcache に保存されたセッションIDを比較して認証する。
</p>

				
				
			
				
				<h3 id="Controller.SyncGame">func (*Controller) <a href="/target/api.go?s=6733:6842#L208">SyncGame</a></h3>
				<pre>func (this *Controller) SyncGame(c appengine.Context, w http.ResponseWriter, r *http.Request, gameKey string)</pre>
				<p>
ゲームデータの同期
</p>

				
				
			
				
				<h3 id="Controller.SyncHandler">func (*Controller) <a href="/target/api.go?s=6244:6319#L189">SyncHandler</a></h3>
				<pre>func (this *Controller) SyncHandler(w http.ResponseWriter, r *http.Request)</pre>
				<p>
/sync/* にマッチしたら呼び出される。
エディタで編集したゲーム情報をサーバと同期するための処理。
URL を解析して更に細かいハンドラへ処理を割り振る。
</p>

				
				
			
				
				<h3 id="Controller.SyncScene">func (*Controller) <a href="/target/api.go?s=7412:7522#L235">SyncScene</a></h3>
				<pre>func (this *Controller) SyncScene(c appengine.Context, w http.ResponseWriter, r *http.Request, sceneId string)</pre>
				<p>
シーンデータの同期
</p>

				
				
			
				
				<h3 id="Controller.Top">func (*Controller) <a href="/target/page.go?s=201:268#L1">Top</a></h3>
				<pre>func (this *Controller) Top(w http.ResponseWriter, r *http.Request)</pre>
				<p>
ログインページの表示。セッションが既に開始されている場合はゲームリストを表示する。
</p>

				
				
			
				
				<h3 id="Controller.Upload">func (*Controller) <a href="/target/api.go?s=5189:5259#L154">Upload</a></h3>
				<pre>func (this *Controller) Upload(w http.ResponseWriter, r *http.Request)</pre>
				<p>
クライアントからアップロードされたファイルを blobstore に保存して blobkey を返す。。
Ajax で使う。method は POST。
</p>

				
				
			
		
		</div>
	

	







